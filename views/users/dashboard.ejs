<% layout("./layouts/boilerplate.ejs") %>
  <%- include("../layouts/partials/error-flash.ejs") %>
    <div class="row">
      <!-- MINI MENU -->
      <div class="mb-4 mb-md-0 col-12 col-sm-12 col-md-4 col-lg-3 offset-lg-1">
        <div class="list-group" id="list-tab" role="tablist">
          <a class="list-group-item list-group-item-action active" id="list-home-list" data-bs-toggle="list"
            href="#list-profile" role="tab" aria-controls="profile">Profile</a>
          <a class="list-group-item list-group-item-action" id="list-messages-list" data-bs-toggle="list"
            href="#list-stats" role="tab" aria-controls="stats">Stats</a>
          <a class="list-group-item list-group-item-action" id="list-settings-list" data-bs-toggle="list"
            href="#list-settings" role="tab" aria-controls="settings">Settings</a>
        </div>
      </div>
      <div class="col-12 col-sm-12 col-md-8 col-lg-5 offset-lg-1">
        <div class="tab-content" id="nav-tabContent">
          <!-- PROFILE TAB -->
          <div class="tab-pane fade show active" id="list-profile" role="tabpanel" aria-labelledby="list-profile-list">
            <div class="card">
              <!-- IMAGE SECTION -->
              <div class="p-3 pb-2 position-relative">
                <img src="<%= userImage %>" class="card-img-top" alt="Your profile image.">
                <!-- Button trigger modal -->
                <button type="button" class="btn btn-sm btn-primary position-absolute top-0 start-0 m-4"
                  data-bs-toggle="modal" data-bs-target="#imageEditModal">
                  Change
                </button>
              </div>
              <!-- Edit Image Modal -->
              <div class="modal fade" id="imageEditModal" tabindex="-1" aria-labelledby="imageEditModalLabel"
                aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="imageEditModalLabel">Change Profile Image</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <!-- Edit form -->
                    <div class="modal-body">
                      <form action="/users/<%= signedUser.username %>?_method=PATCH&_csrf=<%= csrfToken %>"
                        method="POST" class="mt-1 mb-2" enctype="multipart/form-data">
                        <label for="image" class="form-label">Upload the new Image:</label>
                        <input type="file" class="form-control" id="image" name="user[image]">
                        <div class="d-flex justify-content-between p-0 mt-4">
                          <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                          <button type="submit" class="btn btn-success">Save</button>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
              <!-- End Modal -->
              <div class="card-body pt-1">
                <ul class="list-group list-group-flush">
                  <!-- USERNAME SECTION -->
                  <h5 class="card-title mb-0 mt-2">Username:</h5>
                  <li class="list-group-item px-0 pb-3">
                    <div class="d-flex justify-content-between">
                      <span class="align-self-end">
                        <%= signedUser.username %>
                      </span>
                      <button class="btn btn-secondary btn-sm text-end" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseUserNameEdit" aria-expanded="false"
                        aria-controls="collapseUserNameEdit">Change</button>
                    </div>
                    <!-- Edit form -->
                    <div class="collapse mt-3 text-start" id="collapseUserNameEdit">
                      <form action="/users/<%= signedUser.username %>?_method=PATCH" method="POST"
                        class="d-flex flex-column justify-content-center align-items-center">
                        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                        <label for="username" class="form-label text-muted">Your new username:</label>
                        <input type="text" name="user[username]" id="username" value="<%= signedUser.username %>"
                          placeholder="Username">
                        <button class="btn btn-sm btn-success mt-3" type="submit">Submit Change</button>
                      </form>
                    </div>
                  </li>
                  <!-- BIRTHDATE SECTION -->
                  <h5 class="card-title mb-0 mt-2">Birthdate:</h5>
                  <li class="list-group-item px-0 pb-3">
                    <div class="d-flex justify-content-between">
                      <span class="align-self-end">
                        <% if (userBirthday) { %>
                          <%= userBirthday %>
                            <% } else { %>
                              <span class="text-muted">N/A</span>
                              <% } %>
                      </span>
                      <button class="btn btn-secondary btn-sm mt-2 text-end" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseBirthDayEdit" aria-expanded="false"
                        aria-controls="collapseBirthDayEdit">Change</button>
                    </div>
                    <!-- Edit form -->
                    <div class="collapse mt-3 text-start" id="collapseBirthDayEdit">
                      <form action="/users/<%= signedUser.username %>?_method=PATCH" method="POST"
                        class="d-flex flex-column justify-content-center align-items-center">
                        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                        <label for="birthday" class="form-label text-muted">Select your birthdate:</label>
                        <input type="date" id="birthday" name="user[birthday]" value="<%= userBirthday !== " N/A" ?
                          userBirthday.split("/").reverse().join("-") : "yyyy-mm-dd" %>">
                        <button class="btn btn-sm btn-success mt-3" type="submit">Submit Change</button>
                      </form>
                    </div>
                  </li>
                  <!-- BIO SECTION -->
                  <h5 class="card-title mb-0 mt-2">Your Bio:</h5>
                  <li class="list-group-item text-end px-0">
                    <div class="d-flex justify-content-between text-start">
                      <% if (userBio) { %>
                        <p class="p-0 m-0 text-break text-wrap">
                          <%= userBio %>
                        </p>
                        <% } else { %>
                          <span class="text-muted">You haven't written any bio. Click 'change' to write it.</span>
                          <% } %>
                    </div>
                    <button class="btn btn-secondary btn-sm text-end mt-2 mt-md-0" type="button"
                      data-bs-toggle="collapse" data-bs-target="#collapseBioEdit" aria-expanded="false"
                      aria-controls="collapseBioEdit">Change</button>
                    <!-- Edit form -->
                    <div class="collapse mt-3 text-start" id="collapseBioEdit">
                      <form action="/users/<%= signedUser.username %>?_method=PATCH" method="POST">
                        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                        <label for="bio" class="form-label text-muted">Write here your Bio:</label>
                        <textarea class="form-control" id="bio" rows="3" name="user[bio]"
                          placeholder="Write your bio here." required><%= userBio %></textarea>
                        <button class="btn btn-sm btn-success mt-3" type="submit">Submit Change</button>
                      </form>
                    </div>
                  </li>
                </ul>
              </div>
            </div>
          </div>
          <!-- STATS TAB -->
          <div class="tab-pane fade" id="list-stats" role="tabpanel" aria-labelledby="list-stats-list">
            <!-- ACCORDION -->
            <div class="accordion" id="accordionStats">
              <section class="accordion-item">
                <h2 class="accordion-header" id="headingOne">
                  <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne"
                    aria-expanded="true" aria-controls="collapseOne">
                    All of your Posts
                  </button>
                </h2>
                <div id="collapseOne" class="accordion-collapse collapse show position-relative"
                  aria-labelledby="headingOne" data-bs-parent="#accordionStats">
                  <div class="accordion-body">
                    <% if (userPosts.length) { %>
                      <!-- CAROUSEL -->
                      <div id="carouselOfPosts" class="carousel slide" data-bs-ride="carousel">
                        <div class="carousel-inner">
                          <!-- POSTS LOOP -->
                          <% for (let i=0; i < userPosts.length; i++) { %>
                            <article class="carousel-item <%= i === 0 ? " active" : null %>">
                              <div style="height: 300px;">
                                <img src="<%= userPosts[i].image %>" class="d-block w-100 h-100" alt="Image of the Post"
                                  style="filter: brightness(50%);">
                                <div><a href="/posts/<%=userPosts[i]._id %>"
                                    class="btn btn-sm btn-success position-absolute top-0 start-0 m-2">Go
                                    to the
                                    Post</a></div>
                              </div>
                              <div class="carousel-caption">
                                <h5>
                                  <%= userPosts[i].title %>
                                </h5>
                                <p>
                                  <%= userPosts[i].text.substring(0, 100) %> ...
                                </p>
                              </div>
                            </article>
                            <% } %>
                              <!-- END LOOP -->
                        </div>
                        <button class="carousel-control-prev" type="button" data-bs-target="#carouselOfPosts"
                          data-bs-slide="prev">
                          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                          <span class="visually-hidden">Previous</span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#carouselOfPosts"
                          data-bs-slide="next">
                          <span class="carousel-control-next-icon" aria-hidden="true"></span>
                          <span class="visually-hidden">Next</span>
                        </button>
                      </div>
                      <% } else { %>
                        <p class="text-center text-muted mb-0">You don't have written any Post.</p>
                        <% } %>
                  </div>
                </div>
              </section>
              <section class="accordion-item">
                <h2 class="accordion-header" id="headingTwo">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                    data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                    All of your comments
                  </button>
                </h2>
                <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo"
                  data-bs-parent="#accordionStats">
                  <div class="accordion-body">
                    <strong>This is the second item's accordion body.</strong> It is hidden by default, until the
                    collapse plugin adds the appropriate classes that we use to style each element. These classes
                    control the overall appearance, as well as the showing and hiding via CSS transitions. You can
                    modify any of this with custom CSS or overriding our default variables. It's also worth noting
                    that just about any HTML can go within the <code>.accordion-body</code>, though the transition
                    does limit overflow.
                  </div>
                </div>
              </section>
              <section class="accordion-item">
                <h2 class="accordion-header" id="headingThree">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                    data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                    Profile Stats
                  </button>
                </h2>
                <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree"
                  data-bs-parent="#accordionStats">
                  <div class="accordion-body">
                    <strong>This is the third item's accordion body.</strong> It is hidden by default, until the
                    collapse plugin adds the appropriate classes that we use to style each element. These classes
                    control the overall appearance, as well as the showing and hiding via CSS transitions. You can
                    modify any of this with custom CSS or overriding our default variables. It's also worth noting
                    that just about any HTML can go within the <code>.accordion-body</code>, though the transition
                    does limit overflow.
                  </div>
                </div>
              </section>
            </div>
          </div>
          <!-- SETTINGS TAB -->
          <div class="tab-pane fade" id="list-settings" role="tabpanel" aria-labelledby="list-settings-list">
            <!--  -->
          </div>
        </div>
      </div>
    </div>